
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>RAW</title>
    <script src="/plantuml-decoder.js"></script>
	<script src="https://cjrtnc.leaningtech.com/2.3/loader.js"></script>
</head>

<body>

		<div class="cell" id="outputDiv">
		</div>
		

<script>
        function done() {
            console.log(window.location.pathname);
            text = window.location.pathname.substring(window.location.pathname.lastIndexOf('/') + 1); // document.getElementById('uml').value;

            text = plantumlEncoder.decode(text);
            text = "@startuml" + "\n" + text + "\n" + "@enduml";
            console.log(text);

            console.time("test_timer");
            for (let step = 0; step < 100; step++) {
                cjCall("com.plantuml.api.cheerpj.v1.Png", "convertToBase64", "light", text).then((raw) => {
                    console.log(raw);
                    var outputDiv = document.getElementById("outputDiv");
                    outputDiv.innerHTML = outputDiv.innerHTML + "\n\n\n" + raw;
                });
            }
            console.timeEnd("test_timer");
        }

        var url = window.location.href;
        var x = url.indexOf("?");
        if (x > 0)
            document.getElementById('uml').value = "...in progress...";
            
        cheerpjInit({
            disableLoadTimeReporting: true,
            disableErrorReporting: true
        }).then((val0) => {
            cheerpjRunMain("com.plantuml.api.cheerpj.v1.RunInit", "/app/plantuml-core.jar").then((val1) => {
                if (x > 0) {
                    var encoded = url.substr(x + 1);
                    console.log(encoded);
                    cjCall("com.plantuml.api.cheerpj.v1.Info", "decode", encoded).then((res) => {
                        document.getElementById('uml').value = res;
                        done();
                    });
                } else
                    done();
            });
        });
	</script>

</body>

</html>
